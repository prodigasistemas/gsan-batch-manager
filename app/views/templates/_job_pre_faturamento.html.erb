<h3><%= processo %></h3>
<hr/>
<%= hidden_field_tag :processo, processo, class: "form-control" %>
<%= hidden_field_tag :nome_batch, klass, class: "form-control" %>
<div class="form-group">
  <%= label_tag "Grupo", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <%= select_tag :grupo, options_for_select(@grupos), class: "form-control", include_blank: true, id: "grupos_faturamento" %>
  </div>
</div>
<div class="form-group">
  <%= label_tag "Ano/MÃªs", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <%= text_field_tag :ano_mes_referencia_text, '', class: "form-control", disabled: true %>
    <%= hidden_field_tag :ano_mes_referencia, '', class: "form-control" %>
  </div>
</div>

<div class="form-group">
  <%= label_tag "Vencimento das contas", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <div class='input-group date' id="calendario_vencimento_contas">
      <%= text_field_tag :vencimento_contas, '', :'data-format' => "dd/MM/yyyy", placeholder: "dd/mm/aaaa", class: "form-control" %>
      <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
      </span>
    </div>
  </div>
</div>


<%= render "shared/agendamento" %>

<div class="form-group">
  <%= label_tag "Localidade", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <%= select_tag :localidade, options_for_select([]), include_blank: true, class: "form-control", id: "localidades" %>
  </div>
</div>

<div class="form-group">
  <%= label_tag "Setor", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <%= select_tag :setor, options_for_select([]), include_blank: true, class: "form-control", id: "setores_comerciais" %>
  </div>
</div>

<div class="form-group">
  <%= label_tag "Rota", nil, class: "col-sm-2 control-label" %>
  <div class="col-sm-6">
    <%= select_tag :id_rota, options_for_select([]), include_blank: true, class: "form-control", id: "id_rota" %>
  </div>
</div>

<div class="form-group">
  <div class="col-sm-offset-2 col-sm-10">
    <%= button_tag "Inserir", class: "btn btn-primary" %>
  </div>
</div>


<script>
$( "#grupos_faturamento" ).change(function () {
$.ajax({
    url: "/processos/get_cronograma_info",
    type: "POST",
    data: {grupo_faturamento: $('#grupos_faturamento option:selected').val()},
    dataType: 'json',
    success: function(data) {
          if (data.ano_mes_referencia) {
            $("#ano_mes_referencia").val(data.ano_mes_referencia);
            $("#ano_mes_referencia_text").val(data.ano_mes_referencia);
          }

          if (data.data_vencimento) {
            $("#vencimento_contas").val(data.data_vencimento);
          } else {
            $("#vencimento_contas").val('');
          }
          
      }
  })

$.ajax({
    url: "/processos/get_cronograma_info",
    type: "POST",
    data: {grupo_faturamento: $('#grupos_faturamento option:selected').val()},
    dataType: 'script'
  })
});

$( "#localidades" ).change(function () {
  $.ajax({
    url: "/processos/pesquisar_setores_comerciais",
    type: "POST",
    data: {
      localidade: $('#localidades option:selected').val(),
      grupo_faturamento: $('#grupos_faturamento option:selected').val()},
    dataType: 'script'
  })
});

$( "#setores_comerciais" ).change(function () {
  $.ajax({
    url: "/processos/pesquisar_rotas",
    type: "POST",
    data: {
      setor_comercial: $('#setores_comerciais option:selected').val(),
      faturamento_grupo: $('#grupos_faturamento option:selected').val()
    },
    dataType: 'script'
  })
});

  $(document).ready(function(){
    $('#calendario_vencimento_contas').datetimepicker({
      pickTime: false,
      language: 'pt-BR'
    });


});
</script>